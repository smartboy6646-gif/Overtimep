<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Cricket Manager</title>
    <style>
        :root { --p: #1a237e; --s: #ffab00; --bg: #f4f6f8; --white: #fff; --red: #d32f2f; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; display: flex; justify-content: center; }
        .app { width: 100%; max-width: 500px; min-height: 100vh; background: var(--white); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }

        /* --- SETUP SCREEN CSS --- */
        #setup-screen { padding: 20px; overflow-y: auto; }
        .team-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .team-inputs input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-weight: bold; }
        .player-entry { display: flex; gap: 5px; margin-bottom: 20px; }
        .player-entry input { flex: 1; padding: 12px; border: 2px solid var(--p); border-radius: 8px; }
        .btn-add { background: var(--p); color: white; border: none; padding: 0 20px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        .squad-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .team-box { background: #f9f9f9; padding: 10px; border-radius: 10px; min-height: 200px; border: 1px solid #eee; }
        .team-box h3 { text-align: center; margin: 0 0 10px 0; font-size: 1rem; color: #555; }
        .p-list-item { background: white; padding: 8px; margin: 5px 0; border-radius: 5px; border-left: 4px solid #ccc; font-size: 0.9rem; display: flex; justify-content: space-between; }
        .tA-item { border-left-color: var(--p); }
        .tB-item { border-left-color: var(--s); }

        .btn-start { width: 100%; padding: 15px; background: #2e7d32; color: white; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 10px; margin-top: 20px; cursor: pointer; }

        /* --- MATCH SCREEN CSS --- */
        #match-screen { display: none; flex-direction: column; height: 100vh; }
        .score-board { background: var(--p); color: white; padding: 20px; text-align: center; border-bottom: 5px solid var(--s); }
        .main-score { font-size: 3.5rem; font-weight: 800; margin: 5px 0; }
        .live-status { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; background: #eee; }
        .status-box { background: white; padding: 10px; border-radius: 8px; border-left: 4px solid var(--p); }
        .active-striker { border-left-color: var(--s); background: #fffde7; }

        .controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 10px; margin-top: auto; background: #fafafa; }
        .btn-ctrl { padding: 15px 0; font-size: 1.2rem; font-weight: bold; border: 1px solid #ddd; border-radius: 8px; background: white; cursor: pointer; }
        .btn-w { background: var(--red); color: white; grid-column: span 2; border: none; }
        .btn-act { background: var(--p); color: white; grid-column: span 4; padding: 12px; margin-top: 5px; }

        .tables { flex: 1; overflow-y: auto; padding: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-bottom: 15px; }
        th { background: #eee; text-align: left; padding: 8px; }
        td { border-bottom: 1px solid #f0f0f0; padding: 8px; }

        /* --- MODAL CSS --- */
        #selection-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-box { background: white; width: 90%; max-width: 350px; padding: 20px; border-radius: 15px; max-height: 80vh; display: flex; flex-direction: column; }
        .list-options { overflow-y: auto; margin: 15px 0; display: flex; flex-direction: column; gap: 8px; }
        .select-btn { padding: 12px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 5px; text-align: left; font-weight: bold; cursor: pointer; }
        .select-btn:hover { background: #e3f2fd; border-color: var(--p); }
    </style>
</head>
<body>

    <div id="setup-screen" class="app">
        <h2 style="text-align:center; color:var(--p);">Match Setup</h2>
        
        <div class="team-inputs">
            <input type="text" id="nameTeamA" placeholder="Team A Name" value="Team A">
            <input type="text" id="nameTeamB" placeholder="Team B Name" value="Team B">
        </div>

        <div class="player-entry">
            <input type="text" id="inputPlayer" placeholder="Enter Player Name">
            <button class="btn-add" onclick="askTeamForPlayer()">ADD</button>
        </div>

        <div class="squad-container">
            <div class="team-box" id="boxTeamA">
                <h3>TEAM A List</h3>
                <div id="listTeamA"></div>
            </div>
            <div class="team-box" id="boxTeamB">
                <h3>TEAM B List</h3>
                <div id="listTeamB"></div>
            </div>
        </div>

        <button class="btn-start" onclick="prepareMatch()">START MATCH</button>
    </div>

    <div id="match-screen" class="app">
        <div class="score-board">
            <div id="ui-batting-team">TEAM NAME</div>
            <div class="main-score" id="ui-score">0 - 0</div>
            <div id="ui-overs">Overs: 0.0</div>
        </div>

        <div class="live-status">
            <div class="status-box active-striker" id="box-s">
                <small>Striker</small><br><b id="ui-s">Select</b> <span id="ui-s-s">0(0)</span>
            </div>
            <div class="status-box" id="box-ns">
                <small>Non-Striker</small><br><b id="ui-ns">Select</b> <span id="ui-ns-s">0(0)</span>
            </div>
            <div class="status-box" style="grid-column: span 2; border-left-color: #d32f2f;">
                <small>Bowler</small><br><b id="ui-b">Select</b> <span id="ui-b-s">0-0 (0.0)</span>
            </div>
        </div>

        <div class="tables">
            <table id="tbl-bat"><thead><tr><th>Batsman</th><th>R</th><th>B</th><th>4s/6s</th></tr></thead><tbody></tbody></table>
            <table id="tbl-bowl"><thead><tr><th>Bowler</th><th>O</th><th>M</th><th>R</th><th>W</th></tr></thead><tbody></tbody></table>
        </div>

        <div class="controls">
            <button class="btn-ctrl" onclick="run(0)">0</button>
            <button class="btn-ctrl" onclick="run(1)">1</button>
            <button class="btn-ctrl" onclick="run(2)">2</button>
            <button class="btn-ctrl" onclick="run(3)">3</button>
            <button class="btn-ctrl" style="background:var(--s)" onclick="run(4)">4</button>
            <button class="btn-ctrl" style="background:orange; color:white" onclick="run(6)">6</button>
            <button class="btn-ctrl" style="background:#eee" onclick="extra('WD')">WD</button>
            <button class="btn-ctrl" style="background:#eee" onclick="extra('NB')">NB</button>
            <button class="btn-ctrl btn-w" onclick="handleWicket()">WICKET</button>
            <button class="btn-ctrl btn-w" style="background:#555" onclick="finishInnings()">END INN</button>
        </div>
    </div>

    <div id="selection-modal">
        <div class="modal-box">
            <h3 id="modal-title">Select Player</h3>
            <div id="modal-list" class="list-options"></div>
        </div>
    </div>

<script>
    // --- DATA STRUCTURE ---
    const game = {
        teamA: { name: "Team A", players: [] },
        teamB: { name: "Team B", players: [] },
        
        currentBatting: "A", // "A" or "B"
        score: 0, wickets: 0, balls: 0,
        striker: null, nonStriker: null, bowler: null, lastBowler: null,
        
        stats: {}, // Stores stats by player name
        innings: 1,
        target: null
    };

    // --- SETUP LOGIC ---
    function askTeamForPlayer() {
        const name = document.getElementById('inputPlayer').value.trim();
        if (!name) return;
        
        // Simple manual confirm (Custom UI can be added, using confirm for speed)
        // Here we just add to the UI and let user tap to move ideally, but let's do a simple Assign logic
        if (confirm(`Add "${name}" to ${document.getElementById('nameTeamA').value}? (Cancel for Team B)`)) {
            addPlayerToTeam('A', name);
        } else {
            addPlayerToTeam('B', name);
        }
        document.getElementById('inputPlayer').value = "";
        document.getElementById('inputPlayer').focus();
    }

    function addPlayerToTeam(teamCode, name) {
        const teamObj = teamCode === 'A' ? game.teamA : game.teamB;
        if(teamObj.players.includes(name)) return alert("Player exists!");
        
        teamObj.players.push(name);
        initPlayerStats(name);
        renderLists();
    }

    function initPlayerStats(name) {
        game.stats[name] = { 
            name: name, runs: 0, balls: 0, fours: 0, sixes: 0, 
            overs: 0, bRuns: 0, wickets: 0, 
            out: false, played: false 
        };
    }

    function renderLists() {
        document.getElementById('listTeamA').innerHTML = game.teamA.players.map(p => `<div class="p-list-item tA-item">${p}</div>`).join('');
        document.getElementById('listTeamB').innerHTML = game.teamB.players.map(p => `<div class="p-list-item tB-item">${p}</div>`).join('');
    }

    function prepareMatch() {
        if (game.teamA.players.length < 2 || game.teamB.players.length < 2) {
            return alert("Add at least 2 players per team!");
        }
        game.teamA.name = document.getElementById('nameTeamA').value;
        game.teamB.name = document.getElementById('nameTeamB').value;
        
        // Hide Setup, Show Match
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('match-screen').style.display = 'flex';
        
        // Start Sequence
        startInningsSequence();
    }

    // --- GAME LOGIC ---

    function startInningsSequence() {
        game.score = 0; game.wickets = 0; game.balls = 0;
        game.striker = null; game.nonStriker = null; game.bowler = null; game.lastBowler = null;
        
        updateUI();
        
        // Sequence: Striker -> Non-Striker -> Bowler
        openSelector('striker', () => {
            openSelector('nonStriker', () => {
                openSelector('bowler', () => {
                    updateUI();
                });
            });
        });
    }

    function openSelector(role, callback) {
        const title = {
            'striker': `Select Striker (${getBattingTeamObj().name})`,
            'nonStriker': `Select Non-Striker (${getBattingTeamObj().name})`,
            'bowler': `Select Bowler (${getBowlingTeamObj().name})`,
            'newBat': `New Batsman (${getBattingTeamObj().name})`
        }[role];

        document.getElementById('modal-title').innerText = title;
        const listDiv = document.getElementById('modal-list');
        listDiv.innerHTML = "";

        // Get Candidates
        let candidates = [];
        if (role === 'striker' || role === 'nonStriker' || role === 'newBat') {
            candidates = getBattingTeamObj().players.filter(p => {
                const s = game.stats[p];
                // Must not be out, and not currently playing (unless selecting initial pair)
                if (s.out) return false;
                if (p === game.striker || p === game.nonStriker) return false;
                return true;
            });
        } else if (role === 'bowler') {
            candidates = getBowlingTeamObj().players.filter(p => p !== game.lastBowler);
        }

        if (candidates.length === 0) {
             alert("No players available! Check team size.");
             document.getElementById('selection-modal').style.display = 'none';
             if(callback) callback();
             return;
        }

        candidates.forEach(p => {
            const btn = document.createElement('div');
            btn.className = 'select-btn';
            btn.innerText = p;
            btn.onclick = () => {
                assignRole(role, p);
                document.getElementById('selection-modal').style.display = 'none';
                if (callback) callback();
            };
            listDiv.appendChild(btn);
        });

        document.getElementById('selection-modal').style.display = 'flex';
    }

    function assignRole(role, name) {
        if (role === 'striker' || role === 'newBat') {
            game.striker = name;
            game.stats[name].played = true;
        } else if (role === 'nonStriker') {
            game.nonStriker = name;
            game.stats[name].played = true;
        } else if (role === 'bowler') {
            game.bowler = name;
        }
    }

    function getBattingTeamObj() { return game.currentBatting === 'A' ? game.teamA : game.teamB; }
    function getBowlingTeamObj() { return game.currentBatting === 'A' ? game.teamB : game.teamA; }

    // --- SCORING ---

    function run(r) {
        game.score += r;
        game.balls++;
        
        // Bat Stats
        const s = game.stats[game.striker];
        s.runs += r; s.balls++;
        if(r===4) s.fours++; if(r===6) s.sixes++;

        // Bowl Stats
        const b = game.stats[game.bowler];
        b.bRuns += r; 
        
        // Logic
        if (r % 2 !== 0) swap();
        checkOver();
        updateUI();
    }

    function extra(type) {
        game.score++;
        game.stats[game.bowler].bRuns++;
        updateUI();
    }

    function handleWicket() {
        game.wickets++;
        game.balls++;
        
        // Stats update
        game.stats[game.striker].balls++;
        game.stats[game.striker].out = true;
        game.stats[game.bowler].wickets++;
        
        // Check All Out
        if (game.wickets >= getBattingTeamObj().players.length - 1) {
            alert("All Out!");
            finishInnings();
            return;
        }

        // Logic: New Batsman First
        openSelector('newBat', () => {
            checkOver(); // Check if that wicket ball was also last ball
            updateUI();
        });
    }

    function checkOver() {
        if (game.balls % 6 === 0 && game.balls > 0) {
            game.stats[game.bowler].overs++; // Crude calc, full implementation requires decimal logic
            game.lastBowler = game.bowler;
            swap();
            // Use Timeout to let UI update before modal
            setTimeout(() => {
                openSelector('bowler', () => { updateUI(); });
            }, 300);
        }
    }

    function swap() { [game.striker, game.nonStriker] = [game.nonStriker, game.striker]; }

    function finishInnings() {
        if (game.innings === 1) {
            alert(`Innings Break! Target: ${game.score + 1}`);
            game.target = game.score + 1;
            game.innings = 2;
            game.currentBatting = game.currentBatting === 'A' ? 'B' : 'A';
            startInningsSequence();
        } else {
            let res = "Match Drawn";
            if (game.score >= game.target) res = `${getBattingTeamObj().name} Won!`;
            else res = `${getBowlingTeamObj().name} Won!`;
            alert(`Game Over! ${res}`);
        }
    }

    // --- UI UPDATES ---
    function updateUI() {
        const battingName = getBattingTeamObj().name;
        document.getElementById('ui-batting-team').innerText = `${battingName} (Inn ${game.innings})`;
        document.getElementById('ui-score').innerText = `${game.score} - ${game.wickets}`;
        
        const ov = Math.floor(game.balls/6);
        const rem = game.balls % 6;
        document.getElementById('ui-overs').innerText = `Overs: ${ov}.${rem}`;

        if(game.striker) {
            const s = game.stats[game.striker];
            document.getElementById('ui-s').innerText = game.striker;
            document.getElementById('ui-s-s').innerText = `${s.runs}(${s.balls})`;
        }
        if(game.nonStriker) {
            const ns = game.stats[game.nonStriker];
            document.getElementById('ui-ns').innerText = game.nonStriker;
            document.getElementById('ui-ns-s').innerText = `${ns.runs}(${ns.balls})`;
        }
        if(game.bowler) {
            const b = game.stats[game.bowler];
            const bo = Math.floor((game.balls % 6 === 0 && game.balls > 0 ? b.overs : (b.overs + rem/10))); // Approximate for live view
            document.getElementById('ui-b').innerText = game.bowler;
            document.getElementById('ui-b-s').innerText = `${b.wickets}-${b.bRuns}`;
        }

        // Tables
        const teamPlayers = getBattingTeamObj().players;
        let batHTML = "";
        teamPlayers.forEach(p => {
            const s = game.stats[p];
            if (s.played) {
                batHTML += `<tr><td>${p} ${s.out?'(out)':(p===game.striker?'*':'')}</td><td>${s.runs}</td><td>${s.balls}</td><td>${s.fours}/${s.sixes}</td></tr>`;
            }
        });
        document.querySelector('#tbl-bat tbody').innerHTML = batHTML;
    }

</script>
</body>
</html>
