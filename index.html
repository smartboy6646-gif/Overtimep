<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cricket Scorer Pro - Fixed</title>
    <style>
        :root { --p: #1a237e; --s: #ffd600; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .card { width: 100%; max-width: 480px; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); min-height: 95vh; display: flex; flex-direction: column; overflow: hidden; }
        
        #setup-modal, #bowler-modal, #final-summary { position: fixed; inset: 0; background: white; z-index: 2000; padding: 25px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        #bowler-modal { background: rgba(0,0,0,0.85); display: none; color: white; justify-content: center; z-index: 2500; }
        .modal-inner { background: white; color: black; padding: 20px; border-radius: 15px; text-align: center; width: 85%; }

        .header { background: var(--p); color: white; padding: 20px; text-align: center; border-bottom: 4px solid var(--s); }
        .score-val { font-size: 3.5rem; font-weight: bold; margin: 5px 0; }
        .target-box { background: var(--s); color: black; padding: 5px 15px; border-radius: 20px; font-weight: bold; display: inline-block; margin-bottom: 10px; }

        .live-players { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; background: #e8eaf6; margin: 10px; border-radius: 10px; }
        .active-p { border-left: 4px solid var(--p); padding-left: 8px; font-weight: bold; color: var(--p); }

        .content { flex-grow: 1; padding: 10px 15px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-bottom: 20px; }
        th { text-align: left; background: #f2f2f2; padding: 10px; border-bottom: 2px solid #ddd; }
        td { padding: 10px; border-bottom: 1px solid #eee; }

        .controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 15px; background: #f9f9f9; border-top: 1px solid #ddd; }
        button { padding: 15px 5px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn-n { background: white; border: 1px solid #ddd; }
        .btn-s { background: var(--s); }
        .btn-w { background: #d32f2f; color: white; grid-column: span 2; }
        .btn-action { background: var(--p); color: white; grid-column: span 4; padding: 18px; }
        input, select { padding: 12px; border-radius: 8px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="setup-modal">
    <h2 style="color:var(--p)">üèè Match Setup</h2>
    <div id="team-input-div">
        <input type="text" id="tA" placeholder="Team 1 Name" value="Nepal">
        <input type="text" id="tB" placeholder="Team 2 Name" value="India">
        <select id="toss_win"><option value="1">Team 1 won Toss</option><option value="2">Team 2 won Toss</option></select>
        <select id="toss_dec"><option value="bat">Batting First</option><option value="bowl">Bowling First</option></select>
    </div>
    <hr>
    <input type="text" id="s1" placeholder="Striker Name">
    <input type="text" id="s2" placeholder="Non-Striker Name">
    <input type="text" id="bw1" placeholder="Bowler Name">
    <button class="btn-action" onclick="startMatch()">START INNINGS</button>
</div>

<div id="bowler-modal">
    <div class="modal-inner">
        <h3>Change Bowler</h3>
        <p style="font-size:0.8rem; color:red;">*Pahilo bowler le lagatar falna paudena</p>
        <div id="bw-list" style="display:flex; flex-wrap:wrap; justify-content:center; gap:8px; margin:15px 0;"></div>
        <input type="text" id="new_bw_inp" placeholder="New Bowler Name" style="margin-bottom:10px;">
        <button onclick="setBowler(document.getElementById('new_bw_inp').value)" class="btn-action">SELECT / ADD</button>
    </div>
</div>

<div class="card">
    <div class="header">
        <div id="ui-team" style="font-size: 1.1rem; opacity: 0.9;">TEAM NAME</div>
        <div class="score-val" id="ui-score">0 - 0</div>
        <div id="ui-overs">Overs: 0.0</div>
        <div id="ui-target-box" style="display:none; margin-top:10px;">
            <span class="target-box" id="ui-target">Target: 0</span>
        </div>
    </div>

    <div class="live-players">
        <div id="box-s" class="active-p">S: <span id="ui-s-nm">-</span><br><b id="ui-s-r">0</b>(<span id="ui-s-b">0</span>)</div>
        <div id="box-ns">NS: <span id="ui-ns-nm">-</span><br><b id="ui-ns-r">0</b>(<span id="ui-ns-b">0</span>)</div>
    </div>
    <div style="padding: 0 15px; font-size: 0.9rem; color: #555;">Current Bowler: <b id="ui-bw-nm">-</b></div>

    <div class="content">
        <h4>Batsmen</h4>
        <table id="tbl-bat"><thead><tr><th>Name</th><th>R</th><th>B</th><th>SR</th></tr></thead><tbody></tbody></table>
        <h4>Bowlers</h4>
        <table id="tbl-bwl"><thead><tr><th>Name</th><th>O</th><th>R</th><th>W</th></tr></thead><tbody></tbody></table>
    </div>

    <div class="controls">
        <button class="btn-n" onclick="addRun(0)">0</button>
        <button class="btn-n" onclick="addRun(1)">1</button>
        <button class="btn-n" onclick="addRun(2)">2</button>
        <button class="btn-n" onclick="addRun(3)">3</button>
        <button class="btn-s" onclick="addRun(4)">4</button>
        <button class="btn-s" style="background:#ff9800;color:white;" onclick="addRun(6)">6</button>
        <button class="btn-n" style="background:#ffccbc" onclick="addExtra()">WD/NB</button>
        <button class="btn-w" onclick="wicket()">WICKET</button>
        <button class="btn-action" onclick="confirmFinish()">FINISH INNINGS</button>
    </div>
</div>

<script>
    let m = {
        teams: [], batting: "", score: 0, wickets: 0, balls: 0,
        striker: "", nonStriker: "", bowler: "", lastBowler: "",
        stats: { bat: {}, bwl: {} },
        inn: 1, target: 0
    };

    function startMatch() {
        if(m.inn === 1) {
            const t1 = document.getElementById('tA').value || "Team 1";
            const t2 = document.getElementById('tB').value || "Team 2";
            m.teams = [t1, t2];
            const toss = document.getElementById('toss_win').value;
            const choice = document.getElementById('toss_dec').value;
            m.batting = (toss == "1") ? (choice == 'bat' ? t1 : t2) : (choice == 'bat' ? t2 : t1);
        }
        
        m.striker = document.getElementById('s1').value || "Bat 1";
        m.nonStriker = document.getElementById('s2').value || "Bat 2";
        const bwl = document.getElementById('bw1').value || "Bowler 1";

        regP(m.striker, 'bat'); regP(m.nonStriker, 'bat');
        setBowler(bwl);

        document.getElementById('setup-modal').style.display = 'none';
        updateUI();
    }

    function regP(n, type) {
        if(type === 'bat' && !m.stats.bat[n]) m.stats.bat[n] = {r:0, b:0, team: m.batting, inn: m.inn};
        if(type === 'bwl' && !m.stats.bwl[n]) {
            let bTeam = m.teams.find(t => t !== m.batting);
            m.stats.bwl[n] = {r:0, b:0, w:0, team: bTeam, inn: m.inn};
        }
    }

    function setBowler(n) {
        if(!n || n === m.lastBowler) { alert("Yo bowler le lagatar over falna paudena!"); return; }
        m.bowler = n;
        regP(n, 'bwl');
        document.getElementById('bowler-modal').style.display = 'none';
        document.getElementById('new_bw_inp').value = "";
        updateUI();
    }

    function addRun(r) {
        m.score += r; m.balls++;
        m.stats.bat[m.striker].r += r; m.stats.bat[m.striker].b++;
        m.stats.bwl[m.bowler].r += r; m.stats.bwl[m.bowler].b++;

        if(r % 2 !== 0) swap();
        if(m.balls % 6 === 0) overEnd();
        checkResult();
        updateUI();
    }

    function addExtra() {
        m.score += 1; m.stats.bwl[m.bowler].r += 1;
        updateUI();
    }

    function swap() { [m.striker, m.nonStriker] = [m.nonStriker, m.striker]; }

    function overEnd() {
        m.lastBowler = m.bowler;
        swap(); updateUI();
        let list = document.getElementById('bw-list');
        list.innerHTML = "";
        let bTeam = m.teams.find(t => t !== m.batting);
        
        Object.keys(m.stats.bwl).forEach(name => {
            if(m.stats.bwl[name].team === bTeam) {
                let btn = document.createElement('button');
                btn.innerText = name;
                btn.disabled = (name === m.lastBowler);
                btn.style = `padding:10px; border-radius:5px; border:none; ${btn.disabled?'background:#ccc':'background:#eee;cursor:pointer'}`;
                btn.onclick = () => setBowler(name);
                list.appendChild(btn);
            }
        });
        document.getElementById('bowler-modal').style.display = 'flex';
    }

    function wicket() {
        m.wickets++; m.balls++;
        m.stats.bat[m.striker].b++; m.stats.bwl[m.bowler].w++; m.stats.bwl[m.bowler].b++;
        updateUI();
        if(m.wickets < 10) {
            let n = prompt("New Batsman Name:");
            if(n) { m.striker = n; regP(n, 'bat'); }
        } else { confirmFinish(); }
        if(m.balls % 6 === 0 && m.wickets < 10) overEnd();
        updateUI();
    }

    function updateUI() {
        document.getElementById('ui-team').innerText = m.batting.toUpperCase() + (m.inn==1?" (1ST INN)":" (2ND INN)");
        document.getElementById('ui-score').innerText = `${m.score} - ${m.wickets}`;
        document.getElementById('ui-overs').innerText = `Overs: ${Math.floor(m.balls/6)}.${m.balls%6}`;
        document.getElementById('ui-s-nm').innerText = m.striker;
        document.getElementById('ui-s-r').innerText = m.stats.bat[m.striker].r;
        document.getElementById('ui-s-b').innerText = m.stats.bat[m.striker].b;
        document.getElementById('ui-ns-nm').innerText = m.nonStriker;
        document.getElementById('ui-ns-r').innerText = m.stats.bat[m.nonStriker].r;
        document.getElementById('ui-ns-b').innerText = m.stats.bat[m.nonStriker].b;
        document.getElementById('ui-bw-nm').innerText = m.bowler;

        if(m.inn === 2) {
            document.getElementById('ui-target-box').style.display = "block";
            document.getElementById('ui-target').innerText = `Target: ${m.target} | Need: ${m.target - m.score}`;
        }

        let batH = ""; for(let p in m.stats.bat) if(m.stats.bat[p].inn === m.inn) batH += `<tr><td>${p}</td><td>${m.stats.bat[p].r}</td><td>${m.stats.bat[p].b}</td><td>${m.stats.bat[p].b>0?((m.stats.bat[p].r/m.stats.bat[p].b)*100).toFixed(0):0}</td></tr>`;
        document.querySelector('#tbl-bat tbody').innerHTML = batH;

        let bwlH = ""; for(let p in m.stats.bwl) if(m.stats.bwl[p].inn === m.inn) bwlH += `<tr><td>${p}</td><td>${Math.floor(m.stats.bwl[p].b/6)}.${m.stats.bwl[p].b%6}</td><td>${m.stats.bwl[p].r}</td><td>${m.stats.bwl[p].w}</td></tr>`;
        document.querySelector('#tbl-bwl tbody').innerHTML = bwlH;
    }

    function checkResult() { if(m.inn === 2 && m.score >= m.target) { alert(m.batting + " WON!"); location.reload(); } }

    function confirmFinish() {
        if(m.inn === 1) {
            alert("1st Innings Over! Target: " + (m.score + 1));
            m.target = m.score + 1; m.inn = 2;
            m.batting = m.teams.find(t => t !== m.batting);
            m.score = 0; m.wickets = 0; m.balls = 0; m.lastBowler = "";
            document.getElementById('setup-modal').style.display = 'flex';
            document.getElementById('team-input-div').style.display = 'none';
        } else {
            alert("Match Finished!"); location.reload();
        }
    }
</script>
</body>
</html>
